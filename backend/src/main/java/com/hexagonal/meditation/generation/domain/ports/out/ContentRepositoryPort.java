package com.hexagonal.meditation.generation.domain.ports.out;

import com.hexagonal.meditation.generation.domain.model.GeneratedMeditationContent;

import java.util.Optional;
import java.util.UUID;

/**
 * Output port for meditation content persistence.
 * Driven port for database operations (CRUD + idempotency).
 * 
 * Hexagonal Architecture - Driven Port (Domain â†’ Infrastructure)
 * BC: Generation
 * 
 * Implementation: PostgresMeditationRepository (JPA + PostgreSQL)
 * Schema: generation, Table: meditation_output
 */
public interface ContentRepositoryPort {

    /**
     * Save meditation output to persistence.
     * 
     * @param output meditation output to save
     * @return saved meditation output
     */
    GeneratedMeditationContent save(GeneratedMeditationContent output);

    /**
     * Find meditation output by ID.
     * 
     * @param id meditation ID
     * @return meditation output if found
     */
    Optional<GeneratedMeditationContent> findById(UUID id);

    /**
     * Find all meditations generated by a user.
     * 
     * @param userId user ID
     * @return list of meditation outputs
     */
    java.util.List<GeneratedMeditationContent> findByUserId(String userId);

    /**
     * Find meditation by idempotency key (for deduplication).
     * Idempotency key = SHA-256(userId|text|musicRef|imageRefOpt)
     * 
     * @param idempotencyKey hash of request parameters
     * @return existing meditation if found (prevents duplicate processing)
     */
    Optional<GeneratedMeditationContent> findByIdempotencyKey(String idempotencyKey);
}
