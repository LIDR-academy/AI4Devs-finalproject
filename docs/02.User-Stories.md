## US1 — Autenticación y acceso seguro

**Título**

Acceder de forma segura al Meditation Builder

**User Story**

Como usuario, quiero identificarme de forma segura en el sistema para poder acceder al Meditation Builder y gestionar mis meditaciones.

**Descripción (negocio)**

Los usuarios deben identificarse antes de poder acceder al Meditation Builder y a cualquier funcionalidad relacionada con meditaciones. Una vez identificado, el usuario puede navegar por el sistema sin volver a introducir sus credenciales mientras su sesión siga siendo válida.

**Criterios de aceptación (BDD, lenguaje de negocio)**

`textFeature: Acceso seguro al Meditation Builder

  Scenario: Usuario se identifica correctamente
    Given existe un usuario registrado en el sistema de meditación
    When se identifica correctamente en la aplicación
    Then puede acceder al Meditation Builder
    And puede usar las funciones de creación y gestión de meditaciones

  Scenario: Credenciales incorrectas impiden el acceso
    Given existe un usuario registrado en el sistema de meditación
    When introduce credenciales incorrectas al intentar identificarse
    Then el acceso al sistema es rechazado
    And el usuario es informado de que sus credenciales no son válidas

  Scenario: Sesión expirada impide el acceso
    Given el usuario se había identificado anteriormente
    And su sesión ya no es válida
    When intenta acceder al Meditation Builder
    Then el acceso es rechazado
    And el usuario es informado de que debe identificarse de nuevo`

**Notas técnicas (no en Gherkin, para diseño/API)**

- La identificación se implementa con AWS Cognito y tokens JWT sin estado en el servidor.
- El token se valida en cada petición a endpoints protegidos.
- Las respuestas técnicas corresponden a 401 cuando las credenciales son inválidas y 403 cuando el token es inválido o está expirado.

---

## US2 — Componer contenido de meditación

**Título**

Componer contenido de meditación con ayuda opcional de IA

**User Story**

Como usuario autenticado, quiero definir el texto, la música y la imagen de una meditación, pudiendo escribirlos manualmente o generarlos con ayuda de IA, para personalizar el contenido antes de crear el vídeo final.

**Descripción (negocio)**

El Meditation Builder permite al usuario definir el contenido de una meditación a través de un campo de texto obligatorio y opciones de música e imagen opcionales. El usuario puede escribir o subir contenido, o pedir al sistema que lo genere a partir de su entrada actual. El usuario puede previsualizar la música y la imagen antes de continuar, sin que todavía se guarde nada de forma permanente.

**Criterios de aceptación (BDD, lenguaje de negocio)**

`Feature: Composición de contenido de meditación

  Scenario: Visualización del campo de texto obligatorio
    Given el usuario está autenticado
    When accede al Meditation Builder
    Then ve un campo de texto obligatorio para definir el contenido de la meditación

  Scenario: Generar texto de meditación desde cero
    Given el usuario está autenticado
    And el campo de texto de la meditación está vacío
    When solicita que el sistema genere el texto de la meditación
    Then el sistema propone un texto completo de meditación en el campo de texto

  Scenario: Generar texto de meditación a partir de contenido existente
    Given el usuario está autenticado
    And el campo de texto de la meditación contiene contenido
    When solicita que el sistema genere el texto de la meditación
    Then el sistema propone un nuevo texto de meditación teniendo en cuenta el contenido existente

  Scenario: Previsualizar música de la meditación
    Given el usuario ha seleccionado música para la meditación
    When solicita previsualizar la música
    Then el sistema reproduce una previsualización de la música seleccionada

  Scenario: Previsualizar imagen de la meditación
    Given el usuario ha seleccionado una imagen para la meditación
    When solicita previsualizar la imagen
    Then el sistema muestra una previsualización de la imagen seleccionada`

**Notas técnicas**

- Las acciones de generación de texto, música e imagen se activan siempre de forma explícita por el usuario (no hay llamadas automáticas a IA).
- La música y la imagen son opcionales pero siempre previsualizables si existen.
- No se realiza persistencia de la meditación en esta historia; el estado vive en la sesión/UI.

---

## US3 — Generar vídeo de meditación de forma asíncrona

**Título**

Generar vídeo de meditación a partir del contenido definido

**User Story**

Como usuario autenticado, quiero pedir la generación de un vídeo de meditación usando el texto, la música y la imagen seleccionados, para obtener una meditación completa en formato vídeo.

**Descripción (negocio)**

Cuando el usuario decide generar el vídeo, el sistema valida que el texto obligatorio de la meditación está definido, crea un registro de meditación con el estado inicial de procesamiento y delega la generación del vídeo a un proceso asíncrono. La meditación puede pasar a estados de completado o error en función del resultado del procesamiento.

**Criterios de aceptación (BDD, lenguaje de negocio)**

`textFeature: Generación asíncrona de vídeo de meditación

  Scenario: Solicitar la generación de un vídeo con texto válido
    Given el usuario está autenticado
    And ha definido un texto de meditación
    When solicita generar el vídeo de la meditación
    Then se crea una nueva meditación en el sistema con estado "en proceso"
    And se registra que la meditación debe ser procesada para generar el vídeo

  Scenario: Rechazar generación de vídeo sin texto
    Given el usuario está autenticado
    And no ha definido el texto de la meditación
    When solicita generar el vídeo de la meditación
    Then la solicitud es rechazada
    And el usuario es informado de que debe completar el texto de la meditación

  Scenario: Marcar la meditación como fallida tras un error de procesamiento
    Given existe una meditación en el sistema con estado "en proceso"
    When se produce un error al procesar la generación del vídeo
    Then la meditación pasa a estado "error"
    And el motivo del fallo queda registrado para diagnóstico interno`

**Notas técnicas**

- Esta historia introduce la primera persistencia de la entidad **`Meditation`** con estados como PENDING/ERROR/DONE.
- Al solicitar la generación, se crea el registro y se publica un trabajo en una cola (por ejemplo SQS) para procesamiento asíncrono.
- El cambio de estado a ERROR o DONE se realiza desde el procesador de jobs.

---

## US4 — Listar y reproducir meditaciones generadas

**Título**

Ver estado y reproducir meditaciones generadas

**User Story**

Como usuario autenticado, quiero ver el listado de mis meditaciones con su estado y reproducir las que ya están completadas, para poder hacer seguimiento y consumir el contenido generado.

**Descripción (negocio)**

El usuario puede consultar todas sus meditaciones, viendo para cada una su estado de procesamiento. Las meditaciones completadas pueden reproducirse directamente, mientras que las que aún están en proceso o han fallado sólo muestran su estado actual.

**Criterios de aceptación (BDD, lenguaje de negocio)**

`textFeature: Listado y reproducción de meditaciones

  Scenario: Listar las meditaciones del usuario con su estado
    Given el usuario está autenticado
    When solicita ver el listado de sus meditaciones
    Then el sistema muestra todas las meditaciones de ese usuario
    And para cada meditación se muestra su estado actual

  Scenario: Reproducir una meditación completada
    Given el usuario está autenticado
    And existe una meditación suya con estado "completada"
    When selecciona reproducir esa meditación
    Then el sistema reproduce el vídeo de esa meditación

  Scenario: No permitir reproducción de meditaciones no completadas
    Given el usuario está autenticado
    And existe una meditación suya que no está en estado "completada"
    When selecciona esa meditación en el listado
    Then el sistema muestra su estado actual
    And no ofrece la opción de reproducir el vídeo`

**Notas técnicas**

- El listado se obtiene mediante un endpoint que filtra por el usuario autenticado.
- Para meditaciones en estado DONE se devuelve una URL reproducible del almacenamiento en la nube; para el resto, esa URL no se expone.
- No se requiere paginación en esta primera versión.