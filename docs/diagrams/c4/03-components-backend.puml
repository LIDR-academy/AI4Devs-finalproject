@startuml 03-components-backend
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

LAYOUT_WITH_LEGEND()

' Generated by C4 Diagram Generator on 2026-01-15
' Agent: C4 Diagram Generator
' System: TravelSplit v1.0.0
' Architecture Pattern: CSED (Controller-Service-Entity-DTO)

title TravelSplit Backend - Component Diagram

' Auth Module (CSED Pattern)
Component(auth_controller, "AuthController", "NestJS Controller", "Maneja peticiones HTTP de autenticacion: registro y login")
Component(auth_service, "AuthService", "NestJS Service", "Logica de negocio: registro de usuarios, validacion de credenciales, generacion de JWT")

' Users Module (CSED Pattern)
Component(users_controller, "UsersController", "NestJS Controller", "Maneja peticiones HTTP de gestion de usuarios: perfil, actualizacion")
Component(users_service, "UsersService", "NestJS Service", "Logica de negocio: CRUD de usuarios, busqueda por email")
ComponentDb(user_entity, "User Entity", "TypeORM Entity", "Modelo de datos de usuario: id, nombre, email, passwordHash")

' Trips Module (CSED Pattern)
Component(trips_controller, "TripsController", "NestJS Controller", "Maneja peticiones HTTP de viajes: crear, listar, unirse, detalle")
Component(trips_service, "TripsService", "NestJS Service", "Logica de negocio: CRUD de viajes, gestion de participantes, codigos de union")
ComponentDb(trip_entity, "Trip Entity", "TypeORM Entity", "Modelo de datos de viaje: id, nombre, joinCode, estado")
ComponentDb(trip_participant_entity, "TripParticipant Entity", "TypeORM Entity", "Modelo de participante: userId, tripId, role (CREATOR/MEMBER)")

' Health Module (CSED Pattern)
Component(health_controller, "HealthController", "NestJS Controller", "Maneja peticiones HTTP de health check")
Component(health_service, "HealthService", "NestJS Service", "Verifica estado de la aplicacion y conexion a DB")

' Common Components
Component(jwt_guard, "JwtAuthGuard", "NestJS Guard", "Protege rutas que requieren autenticacion JWT")
Component(jwt_strategy, "JwtStrategy", "Passport Strategy", "Valida tokens JWT y extrae informacion del usuario")
Component(exception_filter, "AllExceptionsFilter", "NestJS Filter", "Filtra y formatea excepciones HTTP con respuestas consistentes")
Component(user_mapper, "UserMapper", "Mapper", "Mapea entidades User a DTOs de respuesta")
Component(trip_mapper, "TripMapper", "Mapper", "Mapea entidades Trip a DTOs de respuesta")
ComponentDb(base_entity, "BaseEntity", "TypeORM Entity", "Entidad base con id, createdAt, updatedAt, deletedAt")

' External Container (database from discovery.stack.backend.database)
ContainerDb(database, "PostgreSQL Database", "PostgreSQL", "Almacena todas las entidades del sistema")

' Auth Module Relationships
Rel(auth_controller, auth_service, "Usa")
Rel(auth_service, users_service, "Usa para crear/buscar usuarios")
Rel(auth_service, jwt_strategy, "Usa para generar tokens")

' Users Module Relationships
Rel(users_controller, users_service, "Usa")
Rel(users_controller, jwt_guard, "Protegido por")
Rel(users_controller, user_mapper, "Usa para mapear respuestas")
Rel(users_service, user_entity, "Lee y escribe", "TypeORM")
Rel(user_entity, base_entity, "Extiende")

' Trips Module Relationships
Rel(trips_controller, trips_service, "Usa")
Rel(trips_controller, jwt_guard, "Protegido por")
Rel(trips_controller, trip_mapper, "Usa para mapear respuestas")
Rel(trips_service, trip_entity, "Lee y escribe", "TypeORM")
Rel(trips_service, trip_participant_entity, "Lee y escribe", "TypeORM")
Rel(trips_service, user_entity, "Lee para validar participantes", "TypeORM")
Rel(trip_entity, base_entity, "Extiende")
Rel(trip_participant_entity, base_entity, "Extiende")

' Health Module Relationships
Rel(health_controller, health_service, "Usa")

' Common Component Relationships
Rel(jwt_guard, jwt_strategy, "Usa para validar tokens")

' Database Persistence
Rel(user_entity, database, "Persiste en", "SQL/TypeORM")
Rel(trip_entity, database, "Persiste en", "SQL/TypeORM")
Rel(trip_participant_entity, database, "Persiste en", "SQL/TypeORM")

@enduml
