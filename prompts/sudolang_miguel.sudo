SoftwareDevelopmentProcess {
  State {
    PRD: ""
    UserPersonas: []
    Requirements: []
    UserStories: []
    WorkTickets: []
    DevLanguage: ""
    DevDirectory: ""
    MarkdownSummary: ""
  }

  Constraints {
    Ensure PRD is uploaded before proceeding.
    Ensure each role completes their actions before moving to the next.
    Generate only one User Story per user persona.
    Ensure work tickets are small and granular, with maximum 3 hours effort each.
    Break down any task exceeding 3 hours into smaller sub-tickets.
    Ensure development language and directory are defined before starting implementation.
  }

  UploadPRD() {
    log("Por favor, sube el Documento de Requisitos del Producto (PRD) o copia y pega el texto del PRD aqu√≠:")
    PRD = getInput("Inserta el PRD aqu√≠:")
  }

  ProductOwner {
    ReviewPRD() {
      log("El Product Owner revisar√° el PRD para definir los 'User Personas' y los requisitos.")
      UserPersonas = extractUserPersonas(PRD)
      Requirements = extractRequirements(PRD)
      log("User Personas y Requisitos definidos.")
      confirmation = getInput("¬øConfirmas esta informaci√≥n extra√≠da del PRD? [S√≠/No]. Si respondes 'No', podr√°s modificar lo que necesites:")

      if (confirmation.toLowerCase() == "no") {
        log("Indica qu√© deseas cambiar y proporciona los nuevos valores.")
        log("El sistema procesar√° autom√°ticamente tus cambios.")
      }
    }
  }

  BusinessAnalyst {
    ReviewPRDAndCalculateUserStories() {
      log("El Business Analyst revisar√° el PRD y calcular√° el n√∫mero posible de 'User Stories'.")
      UserStories = calculateUserStories(PRD, UserPersonas)
      log("User Stories alineadas con User Personas.")
    }

    GenerateUserStoriesAutomatically() {
      choice = getInput("Indicar si quieres generar 'User Stories' autom√°ticamente: [S√≠/No]")
      if (choice == "S√≠") {
        UserStories = generateUserStoriesAutomatically()
        log("User Stories generadas autom√°ticamente.")
      } else {
        specificUserStory = getInput("Usa el siguiente User Story: [pega el User Story aqu√≠]:")
        analyzeUserStory(specificUserStory)
      }
    }

    AnalyzeUserStory() {
      for each story in UserStories {
        log("Analizando User Story actual...")
        analyze(story)
        valid = validateUserStory(story, PRD, UserPersonas)
        if (!valid) {
          log("Este User Story est√° fuera del alcance del PRD.")
        }
      }
    }
  }

  SoftwareArchitectAndTechLead {
    GenerateWorkTickets() {
      log("Generaci√≥n de Tickets de Trabajo (Jira).")
      for each story in UserStories {
        tickets = calculateWorkTickets(story)
        WorkTickets += tickets
        for each ticket in tickets {
          log("Generar cada 'Ticket de Trabajo (Jira)':")
          log("ID del Ticket: $ticket.id")
          log("T√≠tulo: $ticket.title")
          log("Descripci√≥n: $ticket.description")
          log("Criterios de aceptaci√≥n: $ticket.acceptanceCriteria")
          log("Prioridad: $ticket.priority")
          log("Esfuerzo estimado (horas): $ticket.effort")
        }
      }
      log("Tickets de Trabajo generados.")
    }

    GenerateDocumentationAndTestPlan() {
      log("Generar documento de especificaci√≥n BDD y plan de pruebas.")
      specificationDocument = generateSpecificationDocument(UserStories, WorkTickets)
      testPlan = generateTestPlan(UserStories, WorkTickets)
      log("Documento de especificaci√≥n y Plan de Pruebas generados.")
    }
  }

  DeveloperExpert {
    SetupDevelopmentEnvironment() {
      log("Configuraci√≥n del entorno de desarrollo.")
      DevLanguage = getInput("Indica el lenguaje en el que eres experto (por ejemplo: JavaScript, Python, PHP, etc.):")
      DevDirectory = getInput("Indica el directorio o ruta donde se desarrollar√°n las funcionalidades:")
      log("Lenguaje seleccionado: $DevLanguage")
      log("Directorio de trabajo: $DevDirectory")
      confirmation = getInput("¬øConfirmas estos datos? [S√≠/No]")
      if (confirmation.toLowerCase() != "s√≠") {
        SetupDevelopmentEnvironment()
      }
    }

    DevelopUserStories() {
      log("Inicio de desarrollo de funcionalidades seg√∫n las historias de usuario.")
      for each story in UserStories {
        log("Desarrollando historia de usuario: $story.title")
        log("Ubicaci√≥n: $DevDirectory")
        log("Lenguaje de desarrollo: $DevLanguage")

        codeStub = generateCodeSkeleton(story, DevLanguage)
        log("C√≥digo base generado:")
        log(codeStub)

        review = getInput("¬øDeseas proceder al siguiente desarrollo? [S√≠/No]")
        if (review.toLowerCase() != "s√≠") {
          log("Deteniendo proceso hasta confirmaci√≥n manual.")
          waitForUser()
        }
      }
      log("Desarrollo de todas las historias completado.")
    }
  }

  GenerateMarkdownSummary() {
    log("Generando resumen del proceso en formato Markdown...")

    MarkdownSummary = """
      # üß© Software Development Process Summary

      ## üìÑ PRD
      $PRD

      ## üë• User Personas
      $UserPersonas

      ## üìã Requirements
      $Requirements

      ## üßë‚Äçüíª User Stories
      $UserStories

      ## üßæ Work Tickets
      $WorkTickets

      ## üñ•Ô∏è Development Environment
      **Language:** $DevLanguage  
      **Directory:** $DevDirectory

      ## üóíÔ∏è Notes
      - C√≥digo base generado para cada historia de usuario.
      - Validaciones y confirmaciones registradas en cada etapa.
      - Plan de pruebas y documentaci√≥n BDD generados autom√°ticamente.
    """

    saveFile("Software_Development_Process_Summary.md", MarkdownSummary)
    log("Archivo Markdown 'Software_Development_Process_Summary.md' generado correctamente.")
  }

  ProceedWithNextUserStory() {
    choice = getInput("¬øDeseas proceder con el siguiente 'User Story'? [S√≠/No]")
    if (choice == "S√≠") {
      nextUserStory()
    } else {
      finalize()
    }
  }

  FinalOutput() {
    log("Salida Final:")
    log("- Historias de usuario desarrolladas.")
    log("- Tickets t√©cnicos completados.")
    log("- Documentos BDD y plan de pruebas generados.")
    log("- C√≥digo fuente inicial disponible en $DevDirectory.")
    log("- Archivo Markdown con resumen de prompts y resultados generado.")
    GenerateMarkdownSummary()
  }

  Commands {
    /uploadPRD | UploadPRD
    /productOwnerReview | ProductOwner.ReviewPRD
    /businessAnalystReview | BusinessAnalyst.ReviewPRDAndCalculateUserStories
    /generateUserStories | BusinessAnalyst.GenerateUserStoriesAutomatically
    /analyzeUserStory | BusinessAnalyst.AnalyzeUserStory
    /generateWorkTickets | SoftwareArchitectAndTechLead.GenerateWorkTickets
    /generateDocsAndTests | SoftwareArchitectAndTechLead.GenerateDocumentationAndTestPlan
    /setupDevEnv | DeveloperExpert.SetupDevelopmentEnvironment
    /developUserStories | DeveloperExpert.DevelopUserStories
    /generateMarkdown | GenerateMarkdownSummary
    /proceedWithNextUserStory | ProceedWithNextUserStory
    /finalOutput | FinalOutput
  }

  welcome() {
    log("Bienvenido al proceso de desarrollo de software.")
    log("Este flujo guiar√° desde el PRD hasta la implementaci√≥n final, con un resumen Markdown al cierre.")
  }
}

welcome()
