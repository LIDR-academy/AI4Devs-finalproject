#!/usr/bin/env ruby

# Script rÃ¡pido de verificaciÃ³n del sistema
require File.expand_path('../config/environment', __dir__)

puts "ğŸ” Verificando Sistema VetConnect...\n"

errors = []

# Verificar modelos
begin
  User.first || errors << "User model issue"
  Pet.first || errors << "Pet model issue"
  Appointment.first || errors << "Appointment model issue"
  Clinic.first || errors << "Clinic model issue"
  puts "âœ… Modelos: OK"
rescue => e
  errors << "Model error: #{e.message}"
  puts "âŒ Modelos: ERROR"
end

# Verificar asociaciones
begin
  apt = Appointment.first
  apt.pet && apt.veterinarian && apt.clinic && apt.owner
  puts "âœ… Asociaciones: OK"
rescue => e
  errors << "Association error: #{e.message}"
  puts "âŒ Asociaciones: ERROR"
end

# Verificar disponibilidad
begin
  clinic = Clinic.active.first
  vet = User.veterinarians.first
  slots = Appointment.available_slots(vet.id, Date.tomorrow, clinic.id)
  puts "âœ… AvailabilityCalculator: OK (#{slots.count} slots)"
rescue => e
  errors << "Availability error: #{e.message}"
  puts "âŒ AvailabilityCalculator: ERROR"
end

# Verificar roles y dashboards
begin
  owner = User.owners.first
  vet = User.veterinarians.first
  admin = User.admins.first
  
  owner_apts = Appointment.joins(:pet).where(pets: { user_id: owner.id })
  vet_apts = Appointment.for_veterinarian(vet.id)
  
  puts "âœ… Roles: OK (Owner: #{owner_apts.count} citas, Vet: #{vet_apts.count} citas)"
rescue => e
  errors << "Roles error: #{e.message}"
  puts "âŒ Roles: ERROR"
end

# Resumen
puts "\n" + "=" * 50
if errors.empty?
  puts "âœ… SISTEMA VERIFICADO - TODO FUNCIONAL"
  puts "=" * 50
  puts "\nCredenciales:"
  puts "  Owner:        maria@example.com"
  puts "  Veterinarian: carlos@vetconnect.com"
  puts "  Admin:        admin@vetconnect.com"
  puts "  Password:     password123"
  puts "\nDashboards:"
  puts "  /owner"
  puts "  /veterinarian"
  puts "  /admin"
else
  puts "âŒ ERRORES ENCONTRADOS:"
  errors.each { |e| puts "  - #{e}" }
end
puts "=" * 50
