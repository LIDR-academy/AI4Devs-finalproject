<%= form_with(model: [pet, document], local: true, class: "space-y-6") do |f| %>
  <% if document.errors.any? %>
    <div class="mb-6 bg-red-50 border-l-4 border-red-500 p-4 rounded-lg" role="alert" aria-live="polite">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-red-800">
            <%= pluralize(document.errors.count, "error") %> impidieron guardar este documento:
          </h3>
          <ul class="mt-2 text-sm text-red-700 list-disc list-inside">
            <% document.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      </div>
    </div>
  <% end %>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Title -->
    <div>
      <%= f.label :title, "Título", class: "block text-sm font-medium text-gray-700 mb-2" do %>
        Título <span class="text-red-500" aria-label="requerido">*</span>
      <% end %>
      <%= f.text_field :title, 
          class: "w-full px-4 py-3 border-2 border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all",
          placeholder: "Ej: Resultados de Laboratorio",
          required: true,
          aria: { required: true } %>
    </div>

    <!-- Document Type -->
    <div>
      <%= f.label :document_type, "Tipo de Documento", class: "block text-sm font-medium text-gray-700 mb-2" do %>
        Tipo de Documento <span class="text-red-500" aria-label="requerido">*</span>
      <% end %>
      <%= f.select :document_type, 
          options_for_select([
            ['Resultado de Laboratorio', 'lab_result'],
            ['Radiografía', 'x_ray'],
            ['Prescripción', 'prescription'],
            ['Registro de Vacunación', 'vaccine_record'],
            ['Factura', 'invoice'],
            ['Otro', 'other']
          ], document.document_type), 
          { prompt: "Seleccionar tipo" }, 
          { class: "w-full px-4 py-3 border-2 border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all min-h-[44px]",
            required: true,
            aria: { required: true } } %>
    </div>
  </div>

  <!-- Description -->
  <div>
    <%= f.label :description, "Descripción", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= f.text_area :description, 
        rows: 3,
        class: "w-full px-4 py-3 border-2 border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all resize-y",
        placeholder: "Descripción del documento..." %>
  </div>

  <!-- File Upload (Basic - Active Storage implementation needed) -->
  <div>
    <%= f.label :file_name, "Nombre del Archivo", class: "block text-sm font-medium text-gray-700 mb-2" do %>
      Nombre del Archivo <span class="text-red-500" aria-label="requerido">*</span>
    <% end %>
    <%= f.text_field :file_name, 
        class: "w-full px-4 py-3 border-2 border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all",
        placeholder: "documento.pdf",
        required: true,
        aria: { required: true, describedby: "file-help" } %>
    <p id="file-help" class="mt-1 text-xs text-gray-500">Nota: La carga de archivos con Active Storage se implementará próximamente</p>
  </div>

  <!-- Medical Record (Optional) -->
  <% if pet.medical_records.any? %>
    <div>
      <%= f.label :medical_record_id, "Asociar a Registro Médico", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= f.select :medical_record_id, 
          options_from_collection_for_select(pet.medical_records.recent.limit(10), :id, :display_title, document.medical_record_id),
          { prompt: "Ninguno (opcional)" }, 
          { class: "w-full px-4 py-3 border-2 border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all min-h-[44px]" } %>
    </div>
  <% end %>

  <!-- Actions -->
  <div class="flex flex-col sm:flex-row gap-4 pt-4">
    <%= f.submit document.persisted? ? "Actualizar Documento" : "Subir Documento", 
        class: "flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors min-h-[44px]",
        aria: { label: document.persisted? ? "Actualizar documento" : "Subir nuevo documento" } %>
    <%= link_to "Cancelar", document.persisted? ? document_path(document) : pet_path(pet), 
        class: "flex-1 text-center bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-3 px-6 rounded-lg transition-colors min-h-[44px] flex items-center justify-center" %>
  </div>
<% end %>
