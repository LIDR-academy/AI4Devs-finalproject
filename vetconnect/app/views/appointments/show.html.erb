<div class="px-4 sm:px-6 lg:px-8">
  <div class="max-w-5xl mx-auto">
    <!-- Header with Actions -->
    <div class="flex items-center justify-between mb-8 animate-fade-in">
      <div>
        <h1 class="text-3xl font-bold tracking-tight text-gray-900">Detalles de la Cita üìã</h1>
        <p class="mt-2 text-sm text-gray-600">
          Cita #<%= @appointment.id %> ‚Ä¢ 
          <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium status-<%= @appointment.status %>">
            <%= @appointment.status.humanize %>
          </span>
        </p>
      </div>
      <div class="flex gap-2">
        <%= link_to appointments_path, class: "inline-flex items-center rounded-lg bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-gray-300 hover:bg-gray-50 transition-colors" do %>
          ‚Üê Volver
        <% end %>
      </div>
    </div>

    <!-- Main Info Grid -->
    <div class="grid grid-cols-1 gap-6 lg:grid-cols-3 animate-fade-in">
      <!-- Patient Card -->
      <div class="lg:col-span-1">
        <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-xl overflow-hidden">
          <div class="border-b border-gray-200 bg-gray-50 px-6 py-4">
            <h2 class="text-base font-semibold text-gray-900">üêæ Paciente</h2>
          </div>
          <div class="px-6 py-5">
            <div class="flex items-center mb-4">
              <div class="h-16 w-16 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-4xl">
                <%= @appointment.pet.species == 'dog' ? 'üêï' : @appointment.pet.species == 'cat' ? 'üêà' : 'üêæ' %>
              </div>
              <div class="ml-4">
                <div class="text-lg font-bold text-gray-900"><%= @appointment.pet.name %></div>
                <div class="text-sm text-gray-500"><%= @appointment.pet.species.humanize %></div>
              </div>
            </div>
            <dl class="space-y-3">
              <div>
                <dt class="text-xs font-medium text-gray-500">Raza</dt>
                <dd class="text-sm text-gray-900"><%= @appointment.pet.breed || 'No especificada' %></dd>
              </div>
              <div>
                <dt class="text-xs font-medium text-gray-500">Edad</dt>
                <dd class="text-sm text-gray-900"><%= @appointment.pet.age %> a√±os</dd>
              </div>
              <% if @appointment.pet.weight.present? %>
                <div>
                  <dt class="text-xs font-medium text-gray-500">Peso</dt>
                  <dd class="text-sm text-gray-900"><%= number_with_precision(@appointment.pet.weight, precision: 1) %> kg</dd>
                </div>
              <% end %>
              <div>
                <dt class="text-xs font-medium text-gray-500">Due√±o</dt>
                <dd class="text-sm text-gray-900"><%= @appointment.owner.full_name %></dd>
              </div>
            </dl>
          </div>
        </div>
      </div>

      <!-- Appointment Details -->
      <div class="lg:col-span-2">
        <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-xl overflow-hidden">
          <div class="border-b border-gray-200 bg-gray-50 px-6 py-4">
            <h2 class="text-base font-semibold text-gray-900">üìÖ Informaci√≥n de la Cita</h2>
          </div>
          <div class="px-6 py-5">
            <dl class="grid grid-cols-1 gap-x-6 gap-y-5 sm:grid-cols-2">
              <div>
                <dt class="text-xs font-medium text-gray-500">Fecha y Hora</dt>
                <dd class="mt-1 text-sm text-gray-900 font-semibold">
                  <%= @appointment.appointment_date.strftime('%A, %d de %B de %Y') %><br>
                  <span class="text-purple-600"><%= @appointment.appointment_date.strftime('%H:%M') %></span>
                </dd>
              </div>
              <div>
                <dt class="text-xs font-medium text-gray-500">Duraci√≥n</dt>
                <dd class="mt-1 text-sm text-gray-900"><%= @appointment.duration_minutes %> minutos</dd>
              </div>
              <div>
                <dt class="text-xs font-medium text-gray-500">Veterinario</dt>
                <dd class="mt-1 text-sm text-gray-900 font-medium">Dr. <%= @appointment.veterinarian.full_name %></dd>
              </div>
              <div>
                <dt class="text-xs font-medium text-gray-500">Cl√≠nica</dt>
                <dd class="mt-1 text-sm text-gray-900"><%= @appointment.clinic.name %></dd>
              </div>
              <div>
                <dt class="text-xs font-medium text-gray-500">Tipo de Cita</dt>
                <dd class="mt-1">
                  <span class="inline-flex items-center rounded-full bg-blue-50 px-2.5 py-0.5 text-xs font-medium text-blue-700 capitalize">
                    <%= @appointment.appointment_type.humanize %>
                  </span>
                </dd>
              </div>
              <div>
                <dt class="text-xs font-medium text-gray-500">Estado</dt>
                <dd class="mt-1">
                  <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium status-<%= @appointment.status %>">
                    <%= @appointment.status.humanize %>
                  </span>
                </dd>
              </div>
            </dl>

            <div class="mt-6 border-t border-gray-200 pt-6">
              <dt class="text-xs font-medium text-gray-500 mb-2">Motivo de la Consulta</dt>
              <dd class="text-sm text-gray-900"><%= @appointment.reason %></dd>
            </div>

            <% if @appointment.notes.present? %>
              <div class="mt-4 border-t border-gray-200 pt-4">
                <dt class="text-xs font-medium text-gray-500 mb-2">Notas Adicionales</dt>
                <dd class="text-sm text-gray-900"><%= @appointment.notes %></dd>
              </div>
            <% end %>

            <% if @appointment.cancellation_reason.present? %>
              <div class="mt-4 rounded-lg bg-red-50 p-4 border-l-4 border-red-400">
                <div class="flex">
                  <span class="text-xl mr-2">‚ö†Ô∏è</span>
                  <div>
                    <p class="text-sm font-medium text-red-800">Raz√≥n de Cancelaci√≥n</p>
                    <p class="mt-1 text-sm text-red-700"><%= @appointment.cancellation_reason %></p>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="mt-8 flex flex-wrap gap-3 animate-fade-in">
      <% if policy(@appointment).update? %>
        <%= link_to edit_appointment_path(@appointment), class: "inline-flex items-center rounded-lg bg-white px-4 py-2.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-gray-300 hover:bg-gray-50 transition-colors" do %>
          ‚úèÔ∏è Editar Cita
        <% end %>
      <% end %>

      <% if @appointment.can_be_cancelled? && policy(@appointment).cancel? %>
        <%= link_to cancel_appointment_path(@appointment), 
            method: :post,
            data: { confirm: '¬øEst√°s seguro de que quieres cancelar esta cita?' },
            class: "inline-flex items-center rounded-lg bg-red-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-red-500 transition-colors" do %>
          ‚ùå Cancelar Cita
        <% end %>
      <% end %>

      <% if policy(@appointment).complete? %>
        <%= link_to complete_appointment_path(@appointment),
            method: :post,
            class: "inline-flex items-center rounded-lg bg-green-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-green-500 transition-colors" do %>
          ‚úÖ Completar Cita
        <% end %>
        <%= link_to mark_no_show_appointment_path(@appointment),
            method: :post,
            data: { confirm: '¬øMarcar como no asisti√≥?' },
            class: "inline-flex items-center rounded-lg bg-yellow-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-yellow-500 transition-colors" do %>
          ‚è∞ No Asisti√≥
        <% end %>
      <% end %>
    </div>
  </div>
</div>
