# Sesión 2026-02-18: CU-01 Procesar Compra Mock - Progreso

> **Change**: `cu01-procesar-compra-mock`  
> **Estado**: En progreso (18/25 tareas completadas)

## Resumen

Implementación parcial del Caso de Uso 1 (CU-01): Procesar Compra desde eCommerce (Mock). Flujo principal y FA-2 (tradicional) operativos. Pendiente: DynamoDB, OpenAI en Worker, process-response, tests adicionales.

## Completado

### Infraestructura
- Monorepo (pnpm + Turborepo)
- Migraciones Prisma (Supabase)
- Redis + BullMQ (colas process-conversation)
- Seeds (ecommerce + store mock)
- Docker Compose (Redis, PostgreSQL opcional)

### Backend API
- Endpoint `POST /api/mock/orders` con validación class-validator
- Servicios: Users, Orders, Stores, Conversations, EcommerceSync
- Orquestación por mode (adresles vs tradicional)
- CORS habilitado para Mock UI

### Worker
- App Worker con BullMQ
- ConversationProcessor (journeys GET_ADDRESS e INFORMATION)
- Journey INFORMATION completo
- Journey GET_ADDRESS simplificado (sin OpenAI/DynamoDB aún)

### Integración
- Mock UI (`docs/mock-orders-ui.html`)
- Documentación (`docs/MOCK-ORDERS-README.md`)

## Pendiente para próxima sesión

| Tarea | Descripción |
|-------|-------------|
| 1.3 | Configurar DynamoDB (tabla adresles-messages, TTL 90 días) |
| 4.3 | Completar GET_ADDRESS: integración OpenAI, guardar mensajes en DynamoDB |
| 4.5 | Implementar ResponseProcessor (process-response): validar dirección con Google Maps, actualizar Order/OrderAddress |
| 5.2 | Tests unitarios OrdersService, UsersService |
| 5.3 | Test de integración POST /api/mock/orders |

## Cómo continuar

1. **Leer**: `openspec/changes/cu01-procesar-compra-mock/tasks.md` (tareas con `[ ]` pendientes)
2. **Completar** las 7 tareas pendientes
3. **Ejecutar** `openspec verify --change cu01-procesar-compra-mock` para validar
4. **Archivar** con `openspec archive` o skill openspec-archive-change

## Comandos útiles

```bash
# API
pnpm --filter api dev

# Worker
pnpm --filter worker dev

# Migraciones (desde apps/api)
cd apps/api && npx prisma migrate dev

# Seeds
pnpm db:seed
```

## Notas técnicas

- **Prisma**: Ejecutar desde `apps/api` o usar `pnpm --filter api run prisma:migrate`
- **PowerShell + curl**: Usar `curl.exe` o archivo JSON para evitar problemas de escape
- **Mock UI**: Requiere CORS habilitado en API (`app.enableCors()` en main.ts)
